<!DOCTYPE html>
<html>
<head>
  <title>Study Room - Grow Together 🌱</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #f7fdf8;
      color: #333;
      padding: 20px;
    }

    h1 {
      color: #3b7a57;
    }

    .section {
      margin: 20px auto;
      width: 80%;
      max-width: 500px;
      border: 1px solid #dcdcdc;
      border-radius: 12px;
      padding: 20px;
      background-color: #ffffff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    button {
      background-color: #3b7a57;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
      transition: 0.2s;
    }

    button:hover {
      background-color: #2d5e45;
    }

    img {
      transition: transform 0.6s ease-in-out;
    }

    .animate-grow {
      transform: scale(1.05);
    }
  </style>
</head>
<body>

<h1 id="welcomeMsg">Welcome to the Study Room 👋</h1>

<script>
  const name = "{{ username }}" || localStorage.getItem("username");
  document.getElementById("welcomeMsg").innerText = `Welcome to the Study Room, ${name} 👋`;
</script>

  <p>Work together, learn together, and help your plant grow 🌱</p>

  <!-- 🌿 Shared Study Progress Section -->
  <div class="section">
    <h2>🌱 Grow Your Study Plant</h2>
    <p id="growth-status">Water Points: 0</p>

    <!-- Plant image -->
    <img id="plant" src="{{ url_for('static', filename='images/plant.png') }}" width="200"><br>

    <!-- Actions to water the plant -->
    <button onclick="addWater(1)">Completed a Quiz 💧</button>
    <button onclick="addWater(2)">Studied Together 30 mins 🌿</button>
    <button onclick="addWater(3)">Brainstormed New Idea 🌼</button>
  </div>

  <!-- 🧠 Mini Quiz Section -->
  <div class="section">
    <h2>Quick Quiz</h2>
    <p>What does “AI” stand for?</p>
    <input id="answer" placeholder="Type your answer">
    <button onclick="checkAnswer()">Submit</button>
    <p id="feedback"></p>
  </div>

  <script>
    // 🌿 Plant growth logic
    let waterPoints = 0;

    function addWater(points) {
      waterPoints += points;
      document.getElementById('growth-status').innerText = "Water Points: " + waterPoints;
      updatePlant();
      animatePlant();
    }

    function updatePlant() {
      const plant = document.getElementById('plant');

      if (waterPoints >= 8) {
        plant.src = '/static/images/bloom.png'; // blooming
      } else if (waterPoints >= 4) {
        plant.src = '/static/images/leaf.png'; // sprout
      } else {
        plant.src = '/static/images/plant.png'; // seed
      }
    }

    function animatePlant() {
      const plant = document.getElementById('plant');
      plant.classList.add('animate-grow');
      setTimeout(() => plant.classList.remove('animate-grow'), 600);
    }

    // 🧠 Simple Quiz Logic
    function checkAnswer() {
      const ans = document.getElementById('answer').value.trim().toLowerCase();
      const feedback = document.getElementById('feedback');
      if (ans === 'artificial intelligence') {
        feedback.innerText = '✅ Correct! You earned water points!';
        addWater(1);
      } else {
        feedback.innerText = '❌ Not quite! Try again!';
      }
    }

    async function addWater(points) {
      waterPoints += points;
      document.getElementById('growth-status').innerText = "Water Points: " + waterPoints;
      updatePlant();
      animatePlant();

  // ✅ Send update to backend
      await fetch('/update_progress', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: "{{ username }}", points })
      });
    }

  </script>

</body>
</html>
