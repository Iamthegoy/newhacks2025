<!DOCTYPE html>
<html>
<head>
  <title>{{ user.name }}'s Profile ðŸ’¬</title>
  <style>
    body { font-family: 'Arial', sans-serif; background: #f7fdf8; color: #333; text-align: center; padding: 20px; }
    .profile { background: #fff; padding: 20px; margin: 30px auto; width: 60%; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .chat-box { border:1px solid #dcdcdc; height:250px; overflow-y:auto; padding:10px; background:#f9f9f9; border-radius:10px; margin-top:10px; }
    .chat-input { width:70%; padding:8px; border-radius:8px; border:1px solid #ccc; margin-top:10px; }
    button { padding:8px 12px; border:none; background:#3b7a57; color:white; border-radius:8px; cursor:pointer; }
    button:hover { background:#2e5f44; }
  </style>
</head>
<body>

  <div class="profile">
    <h1>{{ user.name }}'s Profile ðŸŒ¸</h1>
    <p>{{ user.bio }}</p>

    <h3>Chat with {{ user.name }}</h3>
    <div id="chat-box" class="chat-box"></div>

    <input id="chat-input" class="chat-input" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    const currentUser = "{{ username }}";
    const profileUser = "{{ user.username }}";

    async function sendMessage() {
      const input = document.getElementById("chat-input");
      const message = input.value.trim();
      if (!message) return;

      await fetch("/send_message", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sender: currentUser, username: profileUser, message })
      });

      input.value = "";
      loadMessages();
    }

    async function loadMessages() {
      const res = await fetch(`/get_messages/${profileUser}`);
      const messages = await res.json();
      const chatBox = document.getElementById("chat-box");
      chatBox.innerHTML = "";

      messages.forEach(msg => {
        const div = document.createElement("div");
        div.textContent = `${msg.sender}: ${msg.message}`;
        div.style.textAlign = msg.sender === currentUser ? "right" : "left";
        div.style.margin = "5px 0";
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    setInterval(loadMessages, 2000);
    loadMessages();
  </script>

</body>
</html>